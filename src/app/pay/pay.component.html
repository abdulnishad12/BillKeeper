<section class="pay-section">
	<div class="container">
		<div class="pay-section-holder">
			<div class="row" >

			  <div class="col-12 mb-5 animated fadeIn mx-auto" *ngFor="let utility of utilities"
             [ngClass]="{ 'col-lg-6': utilities.length > 1,
                     'col-lg-12': utilities.length === 1 }">
			    <div class="utility-holder utility-holder--variable" *ngIf = "utility.fixedPaymentIndicator===false">

			    	<div class="utility-holder-header">
				    	<h3 class="card-title">{{utility.utilityName}}</h3>
				    </div>

			    	<div class="row utility-holder-content" (focusout) = "totalCalculation = 0;">

				      <div class="utility-holder-content__left-side col-12 col-sm-6 mb-5 mb-sm-0">
				      	<h5>Direct Payment</h5>

                <input #amountOfPaymentVariable
                (keyup) = "formValidationVariablePayment(amountOfPaymentVariable.value,utility.utilityName);"
                placeholder="Enter Payment Amount"
                [value]="totalCalculation!=0 && selectedUtility===utility.utilityName ? totalCalculation : ''"
                class="form-control"
                [ngClass]="{'invalid': validatorVariablePaymentAmount && selectedUtility===utility.utilityName }"
                type="number" >

				        <div class="error"
                     [ngClass]="{ 'show': validatorVariablePaymentAmount && selectedUtility===utility.utilityName,
                     'hide': !(validatorVariablePaymentAmount && selectedUtility===utility.utilityName) }">
				        	Only five-digit positive number allowed
				        </div>

			        	<div class="datepicker">
			    				<p>{{currentYear}}</p>
			    				<select class="custom-select" #dateVariable>
			    					<option selected>{{currentMonth + 1 | month}}</option>
			    					<option>{{currentMonth | month}}</option>
			    				</select>
			    			</div>

			    			<ng-template #confirmVariablePaymentAdd>
			    				<div class="modal-header">
			    					<h4 class="modal-title">Payment Confirmation</h4>
			    				</div>
			    				<div class="modal-body text-center">
			    					<h6 class="text-left">Do you want to make payment for this requisites:</h6>
			    					<div class="detail-item text-left"><span>Payment amount:</span><p>{{+amountOfPaymentVariable.value}}$</p></div>
			    					<div class="detail-item text-left"><span>Date:</span><p>{{dateVariable.value}} {{currentYear}}</p></div>
			    					<div class="detail-item text-left"><span>Utility:</span><p>{{utility.utilityName}}</p></div>

			    					<button type="button" class="button" (click)="addPayment(+amountOfPaymentVariable.value,
			    					utility.utilityName,
			    					dateVariable.value);
			    					modalRef.hide();
			    					amountOfPaymentVariable.value='';">Yes</button>

			    					<button type="button" class="button" (click)="modalRef.hide();amountOfPaymentVariable.value='';">No</button>
			    				</div>
			    			</ng-template>

			    			<ng-template #confirmVariablePaymentUpdate>
			    				<div class="modal-header">
			    					<h4 class="modal-title">Payment Update Confirmation</h4>
			    				</div>
			    				<div class="modal-body text-center">
			    					<h6 class="text-left">You have already did payment with entered requisites:</h6>
			    					<div class="detail-item text-left"><span>Amount:</span><p>{{paymentAmount}}$</p></div>
			    					<div class="detail-item text-left"><span>Date:</span><p>{{dateVariable.value}} {{currentYear}}</p></div>
			    					<div class="detail-item text-left"><span>Utility:</span><p>{{utility.utilityName}}</p></div>
			    				</div>
			    				<div class="modal-footer text-center">
			    					<h6 class="text-left">Do you want to make additional payment?</h6>
			    					<div class="detail-item text-left"><span>Payment amount:</span><p>{{+amountOfPaymentVariable.value}}$</p></div>

                    <button type="button" class="button" (click)="updatePayment(+amountOfPaymentVariable.value,
                    utility.utilityName,
                    dateVariable.value);
			    					modalRef.hide();
			    					amountOfPaymentVariable.value='';">Yes</button>

			    					<button type="button" class="button" (click)="modalRef.hide();amountOfPaymentVariable.value='';">No</button>
			    				</div>
			    			</ng-template>

				        <button id="VariablePriceButton"
                        [ngClass]="{'cursor-off': validatorVariablePaymentAmount
                        || amountOfPaymentVariable.value == ''
                        ||  amountOfPaymentVariable.value== 0 }"
                        type="submit" class="button"
                        (click) = "decideWhichConformationModalOpen(+amountOfPaymentVariable.value,
                        utility.utilityName,
                        dateVariable.value,
                        confirmVariablePaymentAdd,
                        confirmVariablePaymentUpdate);">Pay</button>

				      </div>

				      <div class="utility-holder-content__right-side col-12 col-sm-6">
				      	<h5>Calculation</h5>

				      	<input class="form-control"
				      	(keyup) = "formValidationVariableCalculation(counterForThisMonth.value,utility.utilityName);"
				      	[ngClass]="{'invalid': validatorVariableCalculation[0] && selectedUtility===utility.utilityName }"
				      	type="number" placeholder="Current counter amount" #counterForThisMonth
				      	[popover]="calculationHelper"
				      	popoverTitle="Tariffs for utility: {{utility.utilityName}}"
				      	triggers="focus"
				      	placement="top"
				      	>
				      	<ng-template #calculationHelper>
				      		<div class="calculation-helper text-left">
				      			<span>Tariff: {{utility.tariff}}</span><br>
										<span>Previous Counter: {{utility.previousCounter}}</span>
									</div>
				      	</ng-template>

				      	<div class="error"
                     [ngClass]="{ 'show': validatorVariableCalculation[0] && selectedUtility===utility.utilityName,
                     'hide': !(validatorVariableCalculation[0] && selectedUtility===utility.utilityName) }">

                  {{validatorVariableCalculation[1]}}
				        </div>
				      	<div class="total-holder">
					      	<p>Total:</p>
					      	<span *ngIf="selectedUtility===utility.utilityName">{{totalCalculation}}</span>
					      	<span *ngIf="selectedUtility!=utility.utilityName">{{0}}</span>
				      	</div>

				      	<button type="submit" class="button"
                        [ngClass]="{'cursor-off': validatorVariableCalculation[0]
                        || counterForThisMonth.value =='' ||  counterForThisMonth.value==0 }"
                        (click) = "calculatePaymentAmount(+counterForThisMonth.value,utility.utilityName);
                        counterForThisMonth.value='';">Calculate</button>
				      </div>
			      </div>

			    </div>

			    <div class="utility-holder utility-holder--fixed col-12" *ngIf = "utility.fixedPaymentIndicator===true">

			    	<div class="utility-holder-header">
			    		<h3 class="card-title">{{utility.utilityName}}</h3>
			    	</div>

			    	<div class="row utility-holder-content">
			    		<div class="utility-holder-content__left-side col-12">

			    			<h5>Direct Payment</h5>

			    			<input type="number" class="form-control"
                (focus)="amountOfPaymentFixed.value = utility.tariff.toString()"
			    			(keyup) = "formValidationFixedPayment(amountOfPaymentFixed.value,utility.utilityName);"
			    			[ngClass]="{'invalid': validatorFixedPaymentAmount && selectedUtility===utility.utilityName }"
			    			placeholder="Enter payment amount" #amountOfPaymentFixed >

			    			<div class="error"
                     [ngClass]="{ 'show': validatorFixedPaymentAmount && selectedUtility===utility.utilityName,
                     'hide': !(validatorFixedPaymentAmount && selectedUtility===utility.utilityName) }">
				        	Only five-digit positive number allowed
				        </div>

			    			<div class="datepicker">
			    				<p>{{currentYear}}</p>
			    				<select class="custom-select" #dateFixed>
			    					<option>{{currentMonth + 1 | month}}</option>
			    					<option>{{currentMonth | month}}</option>
			    				</select>
			    			</div>

			    			<ng-template #confirmFixedPaymentAdd>
			    				<div class="modal-header">
			    					<h4 class="modal-title">Payment Confirmation</h4>
			    				</div>
			    				<div class="modal-body text-center">
			    					<h6 class="text-left">Do you want to make payment for this requisites:</h6>
			    					<div class="detail-item text-left"><span>Payment amount:</span><p>{{+amountOfPaymentFixed.value}}$</p></div>
			    					<div class="detail-item text-left"><span>Date:</span><p>{{dateFixed.value}} {{currentYear}}</p></div>
			    					<div class="detail-item text-left"><span>Utility:</span><p>{{utility.utilityName}}</p></div>
			    					<button type="button" class="button"
                            (click)="addPayment(+amountOfPaymentFixed.value,utility.utilityName,dateFixed.value);
                            modalRef.hide();amountOfPaymentFixed.value='';">Yes</button>
			    					<button type="button" class="button"
                            (click)="modalRef.hide();amountOfPaymentFixed.value='';">No</button>

			    				</div>
			    			</ng-template>

			    			<ng-template #confirmFixedPaymentUpdate>
			    				<div class="modal-header">
			    					<h4 class="modal-title">Payment Update Confirmation</h4>
			    				</div>
			    				<div class="modal-body text-center">
			    					<h6 class="text-left">You have already did payment with entered requisites:</h6>
			    					<div class="detail-item text-left"><span>Amount:</span><p>{{paymentAmount}}$</p></div>
			    					<div class="detail-item text-left"><span>Date:</span><p>{{dateFixed.value}} {{currentYear}}</p></div>
			    					<div class="detail-item text-left"><span>Utility:</span><p>{{utility.utilityName}}</p></div>
			    				</div>
			    				<div class="modal-footer text-center">
			    					<h6 class="text-left">Do you want to make additional payment?</h6>
			    					<div class="detail-item text-left"><span>Payment amount:</span><p>{{+amountOfPaymentFixed.value}}$</p></div>
			    					<button type="button" class="button"
                            (click)="updatePayment(+amountOfPaymentFixed.value,utility.utilityName,dateFixed.value);
                            modalRef.hide();amountOfPaymentFixed.value='';">Yes</button>
			    					<button type="button" class="button"
                            (click)="modalRef.hide();amountOfPaymentFixed.value='';">No</button>
			    				</div>
			    			</ng-template>


			    			<button type="submit" class="button"
                        [ngClass]="{'cursor-off': validatorFixedPaymentAmount
                        || amountOfPaymentFixed.value == '' ||  amountOfPaymentFixed.value== 0 }"
                        (click) = "decideWhichConformationModalOpen(+amountOfPaymentFixed.value,
                        utility.utilityName,
                        dateFixed.value,
                        confirmFixedPaymentAdd,
                        confirmFixedPaymentUpdate);">Pay</button>

			    		</div>
			    	</div>
			    </div>
			  </div>

		  </div>

		</div>

		<ng-template  #modalWindowIfUtilitiesListEmpty>
			<div class="modal-header">
				<h4 class="modal-title">You haven't added any utilities yet</h4>
			</div>
			<div class="modal-body text-center">
				<span class="text-center">Do you want to add new utility?</span><br>
				<button type="button" class="button" routerLink="/settings" (click)="modalRef.hide();">Yes</button>
				<button type="button" class="button" (click)="modalRef.hide();">No</button>
			</div>
		</ng-template>

	</div>
</section>
