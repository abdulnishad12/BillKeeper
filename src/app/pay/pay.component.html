<section class="pay-page-holder">
	<div class="container">

		<div class="pay-page-holder__content">
			<div class="row">

			  <div class="col-lg-6 mb-5" *ngFor="let utility of tariffs">
			    <div class="utility-holder utility-holder--variable" *ngIf = "utility.fixedPayment===false">
			    	
			    	<div class="utility-holder__header">
				    	<h3 class="card-title">{{utility.utilityName}}</h3>
				    	<button type="button" (click)="openModal(confirmDeleteUtility)">
				    		<span aria-hidden="true">&times;</span>
				    	</button>
				    </div>

			    	<div class="row utility-holder-content"> 
				      <div class="utility-holder-content__left-side col-6">

				      	<h5>Direct Payment</h5>

				        <input #amountOfPaymentVariable (keyup) = "formValidationVariablePayment(amountOfPaymentVariable.value,utility.utilityName);" placeholder="Enter Payment Amount"  [value]="totalCalculation!=0 && selectedUtility===utility.utilityName ? totalCalculation : ''"  class="form-control" [ngClass]="{'invalid': validatorVariablePaymnetAmount && selectedUtility===utility.utilityName }" type="number" >

				        <div class="error" [ngClass]="{ 'show': validatorVariablePaymnetAmount && selectedUtility===utility.utilityName,'hide': !(validatorVariablePaymnetAmount && selectedUtility===utility.utilityName) }">
				        	Only five-digit positive number allowed
				        </div>

			        	<div class="datepicker">
			    				<p>{{currentYear}}</p>
			    				<select class="custom-select" #dateVariable>
			    					<option selected>{{currentMonth + 1 | month}}</option>
			    					<option>{{currentMonth | month}}</option>
			    				</select>
			    			</div>

			    			<ng-template #confirmVariablePayment>
			    				<div class="modal-header">
			    					<h4 class="modal-title">Payment Confirmation</h4>
			    				</div>
			    				<div class="modal-body text-center">
			    					<p>Are you sure about this payment?</p>
			    					<p>Date: {{dateVariable.value}} {{currentYear}}</p>
										<p>Utility: {{utility.utilityName}}</p>
			    					<p>Payment amount: {{+amountOfPaymentVariable.value}}$</p>
			    					<button type="button" class="button" (click)="addPayment(+amountOfPaymentVariable.value,utility.utilityName,dateVariable.value);modalRef.hide();amountOfPaymentVariable.value='';showAlert('successAddNewPayment');">Yes</button>
			    					<button type="button" class="button" (click)="modalRef.hide();amountOfPaymentVariable.value='';">No</button>
			    				</div>
			    			</ng-template>

			    			<ng-template #confirmVariableUpdate>
			    				<div class="modal-header">
			    					<h4 class="modal-title">Update Confirmation</h4>
			    				</div>
			    				<div class="modal-body text-center">
			    					<p>You have already did payment for this:</p>
			    					<p>Amount: {{paymentAmount}}$</p>
										<p>Date: {{dateVariable.value}} {{currentYear}}</p>
										<p>Utility: {{utility.utilityName}}</p>
			    					<p>Are you sure about additional payment?</p>
			    					<p>Payment amount: {{+amountOfPaymentVariable.value}}$</p>
			    					<button type="button" class="button" (click)="updatePayment(+amountOfPaymentVariable.value,utility.utilityName,dateVariable.value);modalRef.hide();amountOfPaymentVariable.value='';showAlert('successUpdatePayment');">Yes</button>
			    					<button type="button" class="button" (click)="modalRef.hide();amountOfPaymentVariable.value='';">No</button>
			    				</div>
			    			</ng-template>
				        <button id="VariblePriceButton" [ngClass]="{'cursor-off': validatorVariablePaymnetAmount || amountOfPaymentVariable.value == '' ||  amountOfPaymentVariable.value== 0 }" type="submit" class="button"  (click) = "getPaymentInformation(+amountOfPaymentVariable.value,utility.utilityName,dateVariable.value,confirmVariablePayment,confirmVariableUpdate);">Pay</button>
				    
				      </div>

				      <div class="utility-holder-content__right-side col-6">

				      	<h5>Calculation</h5>

				      	<input class="form-control" 
				      	(keyup) = "formValidationVariableCalculation(counterForThisMonth.value,utility.utilityName);" 
				      	[ngClass]="{'invalid': validatorVariableCalculation && selectedUtility===utility.utilityName }" 
				      	type="number" placeholder="Enter counter amount" #counterForThisMonth 
				      	[popover]="counterForThisMonthHelp"
				      	popoverTitle="Tariff for utility: {{utility.utilityName}}"
				      	triggers="focus"
				      	>
				      	<ng-template #counterForThisMonthHelp>
								Tariff: {{utility.tariff}}<br>
								Start Counter: {{utility.counterForPreviousMonth}}
				      	</ng-template>
				      	<div class="error" [ngClass]="{ 'show': validatorVariableCalculation && selectedUtility===utility.utilityName,'hide': !(validatorVariableCalculation && selectedUtility===utility.utilityName) }">
				        	Must be greater than Start Counter
				        </div>
				      	<div class="total-holder">
					      	<p>Total:</p>
					      	<span *ngIf="selectedUtility===utility.utilityName">{{totalCalculation}}</span>
					      	<span *ngIf="selectedUtility!=utility.utilityName">{{0}}</span>
				      	</div>

				      	<button type="submit" class="button" [ngClass]="{'cursor-off': validatorVariableCalculation || counterForThisMonth.value =='' ||  counterForThisMonth.value==0 }" (click) = "getCalculateInformation(+counterForThisMonth.value,utility.utilityName);">Calculate</button> 	
				      </div>
			      </div>

			    </div>

			    <div class="utility-holder utility-holder--fixed" *ngIf = "utility.fixedPayment===true">

			    	<div class="utility-holder__header">
			    		<h3 class="card-title">{{utility.utilityName}}</h3>
			    		<button type="button" (click)="openModal(confirmDeleteUtility)">
			    			<span aria-hidden="true">&times;</span>
			    		</button>
			    	</div>

			    	<div class="row utility-holder-conten">    		
			    		<div class="utility-holder-content__left-side col-12">

			    			<h5>Direct Payment</h5>

			    			<input type="number" class="form-control"  (keyup) = "formValidationFixedPayment(amountOfPaymentFixed.value,utility.utilityName);" [ngClass]="{'invalid': validatorFixedPaymnetAmount && selectedUtility===utility.utilityName }" placeholder="Enter payment amount" #amountOfPaymentFixed>
			    			<div class="error" [ngClass]="{ 'show': validatorFixedPaymnetAmount && selectedUtility===utility.utilityName,'hide': !(validatorFixedPaymnetAmount && selectedUtility===utility.utilityName) }">
				        	Only five-digit positive number allowed
				        </div>

			    			<div class="datepicker">
			    				<p>{{currentYear}}</p>
			    				<select class="custom-select" #dateFixed>
			    					<option>{{currentMonth + 1 | month}}</option>
			    					<option>{{currentMonth | month}}</option>
			    				</select>
			    			</div>

			    			<ng-template #confirmFixedPayment>
			    				<div class="modal-header">
			    					<h4 class="modal-title">Payment Confirmation</h4>
			    				</div>
			    				<div class="modal-body text-center">
			    					<p>Are you sure about this payment?</p>
			    					<p>Date: {{dateFixed.value}} {{currentYear}}</p>
										<p>Utility: {{utility.utilityName}}</p>
			    					<p>Payment amount: {{+amountOfPaymentFixed.value}}$</p>
			    					<button type="button" class="button" (click)="addPayment(+amountOfPaymentFixed.value,utility.utilityName,dateFixed.value);modalRef.hide();amountOfPaymentFixed.value='';showAlert('successAddNewPayment');">Yes</button>
			    					<button type="button" class="button" (click)="modalRef.hide();amountOfPaymentFixed.value='';showAlert('cancelAlert')">No</button>
			    				</div>
			    			</ng-template>

			    			<ng-template #confirmFixedUpdate>
			    				<div class="modal-header">
			    					<h4 class="modal-title">Update Confirmation</h4>
			    				</div>
			    				<div class="modal-body text-center">
			    					<p>You have already did payment for this:</p>
			    					<p>Amount: {{paymentAmount}}$</p>
			    					<p>Date: {{dateFixed.value}} {{currentYear}}</p>
			    					<p>Utility: {{utility.utilityName}}</p>
			    					<p>Are you sure about additional payment?</p>
			    					<p>Payment amount: {{+amountOfPaymentFixed.value}}$</p>
			    					<button type="button" class="button" (click)="updatePayment(+amountOfPaymentFixed.value,utility.utilityName,dateFixed.value);modalRef.hide();amountOfPaymentFixed.value='';showAlert('successUpdatePayment')">Yes</button>
			    					<button type="button" class="button" (click)="modalRef.hide();amountOfPaymentFixed.value='';showAlert('cancelAlert');">No</button>
			    				</div>
			    			</ng-template>
			    			<alert type="success" class="hide" id="successAddNewPayment">
			    				<strong>Success!</strong> You successfully add new paymnet.
			    			</alert>
			    			<alert type="info" class="hide" id="successUpdatePayment">
			    				<strong>Success!</strong> You successfully update paymnet.
			    			</alert>

			    			<button type="submit" class="button" [ngClass]="{'cursor-off': validatorFixedPaymnetAmount || amountOfPaymentFixed.value == '' ||  amountOfPaymentFixed.value== 0 }" (click) = "getPaymentInformation(+amountOfPaymentFixed.value,utility.utilityName,dateFixed.value,confirmFixedPayment,confirmFixedUpdate);">Pay</button>

			    		</div>
			    	</div>
			    </div>
			    <ng-template #confirmDeleteUtility>
			    	<div class="modal-header">
			    		<h4 class="modal-title">Delete Confirmation</h4>
			    	</div>

			    	<div class="modal-body text-center">
			    		<p>Are you sure that you want to delete this utility:</p>
			    		<p>{{utility.utilityName}}</p>
			    		<button type="button" class="button" (click)="deleteTariff(utility.id);modalRef.hide();">Yes</button>
			    		<button type="button" class="button" (click)="modalRef.hide();">No</button>
			    	</div>
			    </ng-template>
			  </div>

		  </div>

		</div>
	</div>
</section>
